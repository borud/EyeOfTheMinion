<html>
    <head>
        <title>Minion internals</title>

<style>
body {
    background-color: #eeeeee;
    font-family: Sans-serif;
}
div.eyeback {
    position: absolute;
    top: 50px;
    left: 50px;
    border: 1px solid black;
    width: 700px;
    height: 500px;
}
div.controls {
    position: absolute;
    top: 50px;
    left: 1080px;
    width: 100px;
    height: 500px;
    background-color: silver;
    border: 1px solid black;
}
</style>
    </head>
    <body>
        <div class="eyeback">
            <canvas id="eye" width="1024" height="768">
            </canvas>
        </div>

        <div class="controls">
            Pupil
            <button onClick="eye.tinyPupil()">On drugs</button>
            <button onClick="eye.smallPupil()">Small pupil</button>
            <button onClick="eye.normPupil()">Normal pupil</button>
            <button onClick="eye.bigPupil()">Big pupil</button>
            <button onClick="eye.massivePupil()">Another drug</button>
            <hr/>
            States
            <button onClick="eye.normal()">Normal</button>
            <button onClick="eye.sleepy()">Sleepy</button>
            <button onClick="eye.alert()">Alert</button>
            <button onClick="eye.smugMug()">Smug</button>
            <button onClick="eye.vengeance()">Vengeance</button>
            <hr/>
            Look
            <button onClick="eye.lookAt(0,0)">Front</button>
            <button onClick="eye.lookAt(270, 100)">Left</button>
            <button onClick="eye.lookAt(90, 100)">Right</button>
            <button onClick="eye.lookAt(0, 100)">Up</button>
            <button onClick="eye.lookAt(180, 100)">Down</button>
            <hr/>
            Action
            <button onClick="eye.fastBlink()">Fast blink</button>
            <button onClick="eye.slowBlink()">Relaxed blink</button>
            <button onClick="eye.normalBlink()">Normal blink</button>

        </div>

<canvas id="motion_debug"
    width="320" height="240"
    style="position:absolute; top:0; right: 0">
</canvas>

<div id="motion_container"></div>

   <script src="tween.min.js"></script>
    </body>
    <script src="minioneye.js"></script>
    <script src="motiondetect.js"></script>
    <script src="blobdetect.js"></script>
<script>
var eye = new Minion.Eye('eye');
var motion = new Minion.MotionDetector();
function drawMotionSquares(context, motionData, w, h) {
    var canvas = document.getElementById('matrix_debug');
    var context = canvas.getContext('2d');

    for (var x = 0; x < w; x++) {
        for (var y = 0; y < h; y++) {
            context.beginPath();
            var index = x + (y * w);
            if (motionData[index] == 1) {
                context.fillStyle = 'black';
            }
            else {
                context.fillStyle = 'white';
            }
            context.fillRect(x*40, y*40, 40, 40);
            context.closePath();
        }
    }
}

/**
 * Do a debug dump of the data
 */
function debugDump(context, imageData, rectangles) {
    if (imageData) {
        context.putImageData(imageData, 0, 0);
    }
    var cellSize = 40;
    var colors = [ 'red', 'green', 'blue', 'silver', 'orange', 'black', 'purple' ];
    rectangles.forEach(function(rect, index, array) {
        context.beginPath();
        context.lineWidth = 2.0;
        context.strokeStyle = colors[index];
        context.fillStyle = colors[index];
        context.strokeRect(rect.x * cellSize, rect.y * cellSize, rect.w * cellSize, rect.h * cellSize);
        context.globalAlpha = 0.5;
        context.fillRect(rect.x * cellSize, rect.y * cellSize, rect.w * cellSize, rect.h * cellSize);
        context.globalAlpha = 1.0;
        context.closePath();
    });
};


document.addEventListener('DOMContentLoaded', function(event) {
    eye.setBlinkRate(eye.normalBlink, 5000);
    eye.animate();
    motion.setup('motion_container');

    motion.addEventListener('MotionDetected', function(motionData) {
        var canvas = document.getElementById('motion_debug');
        var context = canvas.getContext('2d');
        var image = motion.getLastFrame();

        var blob = new Minion.BlobDetector(motionData,
            motion.getDifferenceWidth(), motion.getDifferenceHeight());
        var rectangles = blob.findBlobs();
        debugDump(context, image, rectangles);
    });

    motion.addEventListener('NoMotionDetected', function() {
      // Do nothing.
    })
});

</script>

</html>
